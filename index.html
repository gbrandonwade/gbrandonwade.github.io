<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsible AI and Me</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e6ed;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #64ffda;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #e0e6ed;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(100, 255, 218, 0.1);
            color: #64ffda;
        }

        .search-container {
            position: relative;
            max-width: 400px;
            width: 100%;
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 8px;
            color: #e0e6ed;
            font-size: 1rem;
        }

        .search-bar:focus {
            outline: none;
            border-color: #64ffda;
            box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .category-filter, .sort-filter {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e6ed;
            font-size: 0.9rem;
        }

        .category-filter:focus, .sort-filter:focus {
            outline: none;
            border-color: #64ffda;
        }

        .btn {
            padding: 0.5rem 1rem;
            background: #64ffda;
            color: #1a1a2e;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #4fd1c7;
            transform: translateY(-2px);
        }

        .posts-container {
            display: grid;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .post {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 2rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .post:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: #64ffda;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .post-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #64ffda;
            margin-bottom: 0.5rem;
        }

        .post-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: #a0a0a0;
            margin-bottom: 1rem;
        }

        .post-category {
            background: rgba(100, 255, 218, 0.2);
            color: #64ffda;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .post-content {
            margin-bottom: 1.5rem;
        }

        .post-content h1, .post-content h2, .post-content h3 {
            color: #64ffda;
            margin: 1.5rem 0 1rem 0;
            font-weight: 600;
        }

        .post-content h1 {
            font-size: 1.8rem;
        }

        .post-content h2 {
            font-size: 1.5rem;
        }

        .post-content h3 {
            font-size: 1.3rem;
        }

        .post-content p {
            margin-bottom: 1rem;
        }

        .post-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
            list-style-type: disc;
        }

        .post-content li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .post-content ul + p,
        .post-content ul + h1,
        .post-content ul + h2,
        .post-content ul + h3 {
            margin-top: 1.5rem;
        }

        .post-content blockquote {
            border-left: 4px solid #64ffda;
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            background: rgba(100, 255, 218, 0.1);
            padding: 1rem;
            border-radius: 4px;
        }

        .post-content a {
            color: #64ffda;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s ease;
        }

        .post-content a:hover {
            border-bottom-color: #64ffda;
        }

        .post-content hr {
            border: none;
            height: 1px;
            background: #333;
            margin: 2rem 0;
        }

        .post-image {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e6ed;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .action-btn:hover {
            background: rgba(100, 255, 218, 0.2);
            border-color: #64ffda;
            color: #64ffda;
        }

        .comments-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #333;
        }

        .comments-header {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #64ffda;
        }

        .comment-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .comment-input {
            flex: 1;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e6ed;
            resize: vertical;
        }

        .comment-input:focus {
            outline: none;
            border-color: #64ffda;
        }

        .comment {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .comment-author {
            font-weight: 600;
            color: #64ffda;
            margin-bottom: 0.5rem;
        }

        .saved-posts {
            margin-top: 2rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid #333;
        }

        .no-posts {
            text-align: center;
            color: #a0a0a0;
            font-style: italic;
            padding: 3rem;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: #a0a0a0;
            border-top: 1px solid #333;
            margin-top: 3rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #64ffda;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                flex-direction: column;
                gap: 1rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .post-header {
                flex-direction: column;
            }
            
            .post-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">Responsible AI and Me</a>
                <div class="nav-links">
                    <a href="/admin" class="btn">Admin</a>
                    <div class="search-container">
                        <input type="text" class="search-bar" placeholder="Search posts..." id="searchInput">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="controls">
            <select class="category-filter" id="categoryFilter">
                <option value="">All Categories</option>
                <option value="tool-reviews">Tool Reviews</option>
                <option value="prompt-engineering">Prompt Engineering</option>
                <option value="ai-experiments">AI Experiments</option>
                <option value="tutorials">Tutorials</option>
                <option value="ethics">Ethics</option>
            </select>
            
            <select class="sort-filter" id="sortFilter">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
            </select>
            
            <button class="btn" onclick="showSavedPosts()">View Saved Posts</button>
            <button class="btn" onclick="showAllPosts()">All Posts</button>
        </div>

        <div class="loading" id="loadingMessage">Loading posts...</div>
        <div class="posts-container" id="postsContainer" style="display: none;">
            <!-- Posts will be loaded from markdown files -->
        </div>

        <div class="saved-posts" id="savedPosts" style="display: none;">
            <h2>Saved Posts</h2>
            <div id="savedPostsContainer"></div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Responsible AI and Me. Exploring AI responsibly, one post at a time.</p>
        </div>
    </footer>

    <script>
        let allPosts = [];
        let currentPosts = [];
        let savedPostIds = JSON.parse(localStorage.getItem('savedPosts') || '[]');
        let allComments = JSON.parse(localStorage.getItem('blogComments') || '{}');

        // Function to parse markdown frontmatter and content
        function parseMarkdown(content) {
            const lines = content.split('\n');
            const frontmatter = {};
            let contentStart = 0;
            
            if (lines[0] === '***') {
                let i = 1;
                while (i < lines.length && lines[i] !== '***') {
                    const line = lines[i].trim();
                    if (line) {
                        const [key, ...valueParts] = line.split(':');
                        frontmatter[key.trim()] = valueParts.join(':').trim().replace(/^["']|["']$/g, '');
                    }
                    i++;
                }
                contentStart = i + 1;
            }
            
            const bodyContent = lines.slice(contentStart).join('\n').trim();
            return { frontmatter, content: bodyContent };
        }

        // Function to load posts from the posts directory
        async function loadPosts() {
            try {
                // For GitHub Pages, we'll use a posts index file
                const response = await fetch('/posts/index.json');
                if (!response.ok) {
                    throw new Error('Posts index not found');
                }
                
                const postsIndex = await response.json();
                const posts = [];
                
                for (const filename of postsIndex.files) {
                    try {
                        const postResponse = await fetch(`/posts/${filename}`);
                        if (postResponse.ok) {
                            const content = await postResponse.text();
                            const { frontmatter, content: bodyContent } = parseMarkdown(content);
                            
                            posts.push({
                                id: filename.replace('.md', ''),
                                title: frontmatter.title || 'Untitled',
                                content: bodyContent,
                                category: frontmatter.category || 'uncategorized',
                                date: frontmatter.date || new Date().toISOString().split('T')[0],
                                image: frontmatter.image || '',
                                comments: allComments[filename] || []
                            });
                        }
                    } catch (error) {
                        console.error(`Error loading post ${filename}:`, error);
                    }
                }
                
                allPosts = posts;
                currentPosts = [...allPosts];
                
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('postsContainer').style.display = 'grid';
                
                sortPosts();
            } catch (error) {
                console.error('Error loading posts:', error);
                // Fallback to sample posts if posts directory doesn't exist
                loadSamplePosts();
            }
        }

        // Fallback sample posts
        function loadSamplePosts() {
            allPosts = [
                {
                    id: 'sample-claude-review',
                    title: "Getting Started with Claude 3.5 Sonnet: A Comprehensive Review",
                    content: "After weeks of testing Claude 3.5 Sonnet, I'm impressed by its reasoning capabilities and code generation. This AI assistant has shown remarkable improvement in understanding context and providing nuanced responses. The model excels in creative writing, technical explanations, and maintaining conversation flow.",
                    category: "tool-reviews",
                    date: "2024-07-10",
                    image: "",
                    comments: []
                },
                {
                    id: 'sample-prompts',
                    title: "10 Essential Prompts for Better AI Conversations",
                    content: "Effective prompting is an art form. Here are my top 10 prompts that have consistently delivered better results: 1) 'Think step by step', 2) 'Explain like I'm 5', 3) 'Provide pros and cons', 4) 'Give me three different approaches', 5) 'What questions should I be asking?' These prompts help structure AI responses for maximum clarity and usefulness.",
                    category: "prompt-engineering",
                    date: "2024-07-08",
                    image: "",
                    comments: []
                }
            ];
            
            currentPosts = [...allPosts];
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('postsContainer').style.display = 'grid';
            sortPosts();
        }

        function formatContent(content) {
            // Much simpler and more reliable markdown parsing
            let lines = content.split('\n');
            let result = [];
            let inList = false;
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                
                // Skip empty lines
                if (!line) {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<br>');
                    continue;
                }
                
                // Handle horizontal rules
                if (line === '***') {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<hr>');
                    continue;
                }
                
                // Handle horizontal rules FIRST (before bullet points)
                if (line === '***') {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<hr>');
                    continue;
                }
                
                // Handle headers
                if (line.startsWith('### ')) {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<h3>' + line.substring(4) + '</h3>');
                    continue;
                }
                if (line.startsWith('## ')) {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<h2>' + line.substring(3) + '</h2>');
                    continue;
                }
                if (line.startsWith('# ')) {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<h1>' + line.substring(2) + '</h1>');
                    continue;
                }
                
                // Handle bullet points
                if (line.startsWith('* ') || line.startsWith('- ')) {
                    if (!inList) {
                        result.push('<ul>');
                        inList = true;
                    }
                    let listItem = line.substring(2);
                    // Handle bold/italic in list items
                    listItem = listItem.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                    listItem = listItem.replace(/\*([^*]+)\*/g, '<em>$1</em>');
                    result.push('<li>' + listItem + '</li>');
                    continue;
                }
                
                // Handle blockquotes
                if (line.startsWith('> ')) {
                    if (inList) {
                        result.push('</ul>');
                        inList = false;
                    }
                    result.push('<blockquote>' + line.substring(2) + '</blockquote>');
                    continue;
                }
                
                // Regular paragraph
                if (inList) {
                    result.push('</ul>');
                    inList = false;
                }
                
                // Handle bold/italic and links in regular text
                line = line.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                line = line.replace(/\*([^*]+)\*/g, '<em>$1</em>');
                line = line.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
                
                result.push('<p>' + line + '</p>');
            }
            
            // Close any open list
            if (inList) {
                result.push('</ul>');
            }
            
            return result.join('\n');
        }

        function getCategoryLabel(category) {
            const labels = {
                'tool-reviews': 'Tool Reviews',
                'prompt-engineering': 'Prompt Engineering',
                'ai-experiments': 'AI Experiments',
                'tutorials': 'Tutorials',
                'ethics': 'Ethics'
            };
            return labels[category] || category;
        }

        function renderPosts(posts) {
            const container = document.getElementById('postsContainer');
            
            if (posts.length === 0) {
                container.innerHTML = '<div class="no-posts">No posts found matching your criteria.</div>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <article class="post">
                    <div class="post-header">
                        <div>
                            <h2 class="post-title">${post.title}</h2>
                            <div class="post-meta">
                                <span class="post-category">${getCategoryLabel(post.category)}</span>
                                <span>Published: ${new Date(post.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${post.image ? `<img src="${post.image}" alt="Post image" class="post-image">` : ''}
                    
                    <div class="post-content">
                        <div>${formatContent(post.content)}</div>
                    </div>
                    
                    <div class="post-actions">
                        <button class="action-btn" onclick="toggleSavePost('${post.id}')">
                            ${savedPostIds.includes(post.id) ? '★ Saved' : '☆ Save'}
                        </button>
                        <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(post.title)}&url=${encodeURIComponent(window.location.href)}" 
                           target="_blank" class="action-btn">Share on X</a>
                        <button class="action-btn" onclick="toggleComments('${post.id}')">
                            💬 Comments (${post.comments.length})
                        </button>
                    </div>
                    
                    <div class="comments-section" id="comments-${post.id}" style="display: none;">
                        <div class="comments-header">Comments</div>
                        <div class="comment-form">
                            <textarea class="comment-input" placeholder="Add a comment..." id="comment-input-${post.id}"></textarea>
                            <button class="btn" onclick="addComment('${post.id}')">Post</button>
                        </div>
                        <div class="comments-list" id="comments-list-${post.id}">
                            ${post.comments.map(comment => `
                                <div class="comment">
                                    <div class="comment-author">Anonymous</div>
                                    <div>${comment.text}</div>
                                    <div style="font-size: 0.8em; color: #a0a0a0; margin-top: 0.5rem;">
                                        ${new Date(comment.date).toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </article>
            `).join('');
        }

        function toggleSavePost(postId) {
            const index = savedPostIds.indexOf(postId);
            if (index > -1) {
                savedPostIds.splice(index, 1);
            } else {
                savedPostIds.push(postId);
            }
            localStorage.setItem('savedPosts', JSON.stringify(savedPostIds));
            renderPosts(currentPosts);
        }

        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
        }

        function addComment(postId) {
            const input = document.getElementById(`comment-input-${postId}`);
            const text = input.value.trim();
            
            if (text) {
                const comment = {
                    text: text,
                    date: new Date().toISOString()
                };
                
                const post = allPosts.find(p => p.id === postId);
                if (post) {
                    post.comments.push(comment);
                    
                    // Save to localStorage
                    allComments[postId] = post.comments;
                    localStorage.setItem('blogComments', JSON.stringify(allComments));
                    
                    input.value = '';
                    renderPosts(currentPosts);
                    toggleComments(postId);
                }
            }
        }

        function filterPosts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            currentPosts = allPosts.filter(post => {
                const matchesSearch = post.title.toLowerCase().includes(searchTerm) || 
                                    post.content.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || post.category === category;
                return matchesSearch && matchesCategory;
            });
            
            sortPosts();
        }

        function sortPosts() {
            const sortBy = document.getElementById('sortFilter').value;
            
            currentPosts.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return sortBy === 'newest' ? dateB - dateA : dateA - dateB;
            });
            
            renderPosts(currentPosts);
        }

        function showSavedPosts() {
            const savedPosts = allPosts.filter(post => savedPostIds.includes(post.id));
            document.getElementById('postsContainer').style.display = 'none';
            document.getElementById('savedPosts').style.display = 'block';
            
            const savedContainer = document.getElementById('savedPostsContainer');
            if (savedPosts.length === 0) {
                savedContainer.innerHTML = '<div class="no-posts">No saved posts yet.</div>';
            } else {
                savedContainer.innerHTML = savedPosts.map(post => `
                    <div class="post">
                        <h3 class="post-title">${post.title}</h3>
                        <div class="post-meta">
                            <span class="post-category">${getCategoryLabel(post.category)}</span>
                            <span>${new Date(post.date).toLocaleDateString()}</span>
                        </div>
                        <p>${post.content.substring(0, 200)}...</p>
                        <button class="action-btn" onclick="toggleSavePost('${post.id}'); showSavedPosts();">Remove from Saved</button>
                    </div>
                `).join('');
            }
        }

        function showAllPosts() {
            document.getElementById('postsContainer').style.display = 'grid';
            document.getElementById('savedPosts').style.display = 'none';
            filterPosts();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', filterPosts);
        document.getElementById('categoryFilter').addEventListener('change', filterPosts);
        document.getElementById('sortFilter').addEventListener('change', sortPosts);

        // Initialize
        loadPosts();

        // Netlify Identity Widget
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>
</body>
</html>
